# Cursor Rules for THE LOST+UNFOUNDS

## TEXT ALIGNMENT RULE - CRITICAL
**NEVER change text alignment to center or justify. ALWAYS use left alignment.**

- Blog post content MUST be `text-left` (NOT `text-center`, NOT `text-justify`)
- Blog post paragraphs MUST be `text-left`
- Blog analysis components MUST be `text-left`
- Headers and titles can be `text-left` or centered based on design, but body text is ALWAYS `text-left`
- If you see `text-justify` or `text-center` on blog content, change it to `text-left`
- DO NOT change alignment unless explicitly asked by the user
- This applies to: BlogPost.tsx, BlogAnalysis.tsx, and any blog-related components

## BLOG POST FORMATTING VERIFICATION RULE - CRITICAL
**ALWAYS check the live URL first, NOT the SQL file, when verifying blog post formatting.**

- Before making any formatting changes, check the actual live blog post URL: `https://www.thelostandunfounds.com/thelostarchives/[slug]`
- Use `curl` or fetch the live page to see how content actually renders
- The SQL file is just the source - the live page shows the real formatting
- Remove "⸻" characters from content - they should NOT appear in blog posts
- Section breaks should use proper paragraph spacing, not "⸻" characters

## BLOG POST PUBLISHING RULE - FOLLOW EVERY TIME

When the user asks to publish a blog post, you MUST follow these steps in order:

### STEP 1: Create SQL File
- Create the SQL file in `sql/create-blog-post-[slug].sql`
- Create the same file in `public/sql/create-blog-post-[slug].sql`
- The SQL file must:
  - Handle multiple schema versions (published field, author_id vs user_id, etc.)
  - Use the pattern from existing blog post SQL files
  - Include proper title, slug, content, excerpt, SEO fields
  - Set published=true and status='published'
  - **CRITICAL: NEVER use ON CONFLICT (slug) - the slug column may not have a unique constraint**
  - **MUST use check-and-insert/update pattern:**
    1. Declare `existing_post_id UUID;` in the DECLARE block
    2. Check if post exists: `SELECT id INTO existing_post_id FROM blog_posts WHERE slug = '[slug]' LIMIT 1;`
    3. For each INSERT statement, wrap it in: `IF existing_post_id IS NOT NULL THEN UPDATE ... ELSE INSERT ... END IF;`
  - This pattern works regardless of whether a unique constraint exists on the slug column

### STEP 2: Update SQL.tsx
- Open `src/pages/SQL.tsx`
- Add fetch code to load the new SQL file (after the last blog post fetch)
- Add the script to the `allScripts` array (order in array doesn't matter - scripts are auto-sorted by createdAt):
  - name: Blog post title
  - filename: create-blog-post-[slug].sql
  - content: The fetched content
  - description: Clear description of what the script does
  - createdAt: getScriptTimestamp('create-blog-post-[slug].sql')
- **CRITICAL: Scripts are automatically sorted by createdAt timestamp (newest first)**
- **New scripts with current timestamps will automatically appear at the top of the page**
- For code organization, you can add new scripts near the top of the array, but the display order is determined by createdAt

### STEP 3: Update API Endpoint
- Open `api/sql/latest.ts`
- Add the new SQL file path to the `SQL_FILES` array

### STEP 4: Commit Changes
- Stage all changed files
- Commit with descriptive message

### STEP 5: Merge to Production
- Checkout `main` branch
- Pull latest from `origin/main`
- Merge the cursor branch into `main`
- Push to `origin/main` to deploy

### STEP 6: Verify Deployment
- The SQL file MUST be accessible at: `https://www.thelostandunfounds.com/sql/create-blog-post-[slug].sql`
- The script MUST appear on the page: `https://www.thelostandunfounds.com/sql`
- Verify the script shows up in the list with copy functionality

### CRITICAL RULES:
1. ALWAYS use the exact URL format: `https://www.thelostandunfounds.com/sql/` (lowercase "sql")
2. ALWAYS merge to `main` branch and push to deploy
3. ALWAYS verify the script appears on the `/sql` page after deployment
4. NEVER skip any of these steps
5. The `/sql` page is the deployment interface - scripts must appear there

### The Purpose:
The `/sql` page at `https://www.thelostandunfounds.com/sql` is where SQL scripts are displayed so they can be copied and executed in Supabase SQL Editor. Every blog post SQL script MUST be accessible and visible on this page.
