# Environment Variables Script Generation Rule

## Rule: Always Use Script Generator for Environment Variable Setup

When setting up environment variables for any service, **ALWAYS** use the script generator system instead of manually creating setup scripts.

### How It Works

1. **Generate Setup Script**: Use the generator to create a setup script for a service
2. **Run Setup Script**: Execute the generated script to set environment variables
3. **Validate Setup**: Use the validation script to verify all variables are set correctly

### Available Commands

#### Generate Setup Scripts
```bash
# Generate script for a specific service
npm run generate-env-script <service-name>

# Available services:
# - supabase
# - turnstile
# - telegram
# - openai
```

#### Validate Environment Variables
```bash
# Validate all (local + Vercel)
npm run validate-env

# Validate only local .env.local
npm run validate-env:local

# Validate only Vercel
npm run validate-env:vercel
```

### Workflow

#### Step 1: Generate Setup Script
```bash
cd /Users/canyouseeus/Desktop/SCOT33/thelostandunfounds
npm run generate-env-script supabase
```

This creates: `scripts/setup-supabase-env.sh`

#### Step 2: Run Setup Script
```bash
./scripts/setup-supabase-env.sh
```

The script will:
- Prompt for required environment variables
- Optionally set optional variables
- Create/update `.env.local` file
- Optionally set Vercel environment variables

#### Step 3: Validate Setup
```bash
npm run validate-env
```

This checks:
- ✅ All required variables are set
- ✅ Variables have correct format
- ✅ No placeholder values remain
- ✅ Vercel variables are set (if configured)

### Adding New Services

To add a new service to the generator, edit `scripts/generate-env-script.js` and add to `ENV_DEFINITIONS`:

```javascript
newservice: {
  name: 'New Service',
  description: 'Description of the service',
  required: [
    {
      key: 'NEW_SERVICE_KEY',
      description: 'Description of the key',
      defaultValue: 'default-value-if-any',
      getFrom: 'https://example.com/get-key',
      validation: (value) => value.length > 0, // Validation function
    },
  ],
  optional: [
    // Optional variables...
  ],
},
```

Then generate the script:
```bash
npm run generate-env-script newservice
```

### Benefits

1. **Consistency**: All setup scripts follow the same pattern
2. **Validation**: Built-in validation for all variables
3. **Automation**: Can set both local and Vercel variables
4. **Maintainability**: Single source of truth for env var definitions
5. **Error Prevention**: Validates formats and prevents placeholder values

### Examples

#### Setup Supabase
```bash
# Generate script
npm run generate-env-script supabase

# Run setup
./scripts/setup-supabase-env.sh

# Validate
npm run validate-env
```

#### Setup Turnstile
```bash
# Generate script
npm run generate-env-script turnstile

# Run setup
./scripts/setup-turnstile-env.sh

# Validate
npm run validate-env:local
```

### Integration with Cursor Rules

When working on environment variable setup:
1. ✅ **Always** use `npm run generate-env-script` to create setup scripts
2. ✅ **Always** run `npm run validate-env` after setting variables
3. ✅ **Never** manually create setup scripts (use generator instead)
4. ✅ **Never** commit actual keys to git (use placeholders in examples)
5. ✅ **Always** validate before marking setup as complete

### Troubleshooting

**Script generation fails:**
- Check service name is in `ENV_DEFINITIONS`
- Verify Node.js is installed: `node --version`

**Validation fails:**
- Check `.env.local` exists and has correct format
- Verify no placeholder values remain
- Check Vercel CLI is installed/configured for Vercel validation

**Setup script fails:**
- Ensure script is executable: `chmod +x scripts/setup-*-env.sh`
- Check you're in the project root directory
- Verify all required inputs are provided

